-- SELECT * FROM VAGAS_DW.FATURAMENTO
-- EXEC VAGAS_DW.SPR_OLAP_Carga_Faturamento

IF EXISTS ( SELECT * FROM SYS.OBJECTS WHERE NAME = 'SPR_OLAP_Carga_Faturamento_Ajustes_Pontuais' AND SCHEMA_NAME(SCHEMA_ID) = 'VAGAS_DW')
DROP PROCEDURE VAGAS_DW.SPR_OLAP_Carga_Faturamento_Ajustes_Pontuais
GO

-- =============================================
-- Author: Luiz Fernando Braz
-- Create date: 06/03/2017
-- Description: Procedure para alimentação do DW
-- Criado para eventuais ajustes realizados pelo financeiro diretamente no ERP e que precisam ser retratadas no DW
-- =============================================
CREATE PROCEDURE VAGAS_DW.SPR_OLAP_Carga_Faturamento_Ajustes_Pontuais

AS
SET NOCOUNT ON


-- AJUSTES DO FINANCEIRO (PRODUTO FOI LANÇADO ERRADO NO ERP)
-- 20160701
UPDATE VAGAS_DW.FATURAMENTO SET PRODUTO = 'COMPL PORTAL',GRUPO_I = 'COMPLEMENTAR',GRUPO_II = 'PORTAL'
FROM VAGAS_DW.FATURAMENTO WHERE NUM_PEDIDO = '007810'

-- 20160701
UPDATE VAGAS_DW.FATURAMENTO SET PRODUTO = 'PUBL ADNETWORK',GRUPO_II = 'ADNETWORK'
FROM VAGAS_DW.FATURAMENTO WHERE NUM_PEDIDO = '009749'

-- AJUSTES DO FINANCEIRO (ITAÚ FOI LANÇADO COM DATA INICIO E FIM DE FORMA ERRADA)
DELETE FROM VAGAS_DW.FATURAMENTO WHERE NUM_PEDIDO = '014572'

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-01-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-02-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-03-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-04-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-05-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-06-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-07-01 00:00:00',52778.25,
										 NULL,NULL,'VAGAS','FIT',0,1)

INSERT INTO VAGAS_DW.FATURAMENTO (NUM_PEDIDO,COD_CLI_CRM,COD_CLI,CLIENTE,PRODUTO,DATA_EMISSAO,DATA_REFERENCIA,VALOR,DATA_INICIO_VIGENCIA,DATA_FIM_VIGENCIA,GRUPO_I,GRUPO_II,FLAG_IMPORTACAO,FLAG_EXIBICAO_PADRAO)
VALUES ('014572','4706c89c-e60e-11e4-a9bf-0ea319e5a468','001931','ITAU UNIBANCO S.A.','VAGAS FIT LIC','2016-08-12 00:00:00','2016-08-01 00:00:00',52778.25,
NULL,NULL,'VAGAS','FIT',0,1)

-- ATUALIZAÇÃO DE FATURAMENTO INDEVIDO PARA PUBLICIDADE (PERMUTA LANCADA INDEVIDAMENTE PARA PUBLIC.)
UPDATE VAGAS_DW.FATURAMENTO SET GRUPO_I = 'VAGAS',GRUPO_II = 'FIT'
FROM VAGAS_DW.FATURAMENTO 
WHERE NUM_PEDIDO = '031379'

-- ALTERAÇÃO SOLICITADA EM 20170803 PELO ANTONY
UPDATE VAGAS_DW.FATURAMENTO SET PRODUTO = 'PUBL ADNETWORK',GRUPO_II = 'ADNETWORK'
FROM VAGAS_DW.FATURAMENTO 
WHERE NUM_PEDIDO = '037588'


-- Antony antecipou o faturamento de Mar/2017 por conta do carnaval e foi necessário este ajuste solicitado por ele
--UPDATE VAGAS_DW.FATURAMENTO SET DATA_REFERENCIA = '20170301' 
--FROM VAGAS_DW.FATURAMENTO A
--WHERE DATA_REFERENCIA = '20170201' -- AND DATA_REFERENCIA < '20170301'
--AND NUM_PEDIDO IN (
--'028073',
--'028115',
--'028118',
--'028124',
--'028125',
--'028126',
--'028131',
--'028132',
--'028133',
--'028139',
--'028140',
--'028142',
--'028148',
--'028149',
--'028157',
--'028158',
--'028161',
--'028167',
--'028169',
--'028179',
--'028181',
--'028186',
--'028188',
--'028189',
--'028192',
--'028193',
--'028195',
--'028205',
--'028210',
--'028214',
--'028220',
--'028221',
--'028227',
--'028228',
--'028229',
--'028234',
--'028251',
--'028252',
--'028257',
--'028263',
--'028271',
--'028114',
--'028116',
--'028117',
--'028121',
--'028123',
--'028128',
--'028130',
--'028135',
--'028136',
--'028143',
--'028152',
--'028153',
--'028154',
--'028276',
--'028281',
--'028284',
--'028291',
--'028299',
--'028302',
--'028309',
--'028315',
--'028321',
--'028322',
--'028327',
--'028340',
--'028341',
--'028349',
--'028352',
--'028355',
--'028358',
--'028359',
--'028364',
--'028365',
--'028367',
--'028371',
--'028373',
--'028383',
--'028486',
--'028489',
--'028392',
--'028397',
--'028402',
--'028409',
--'028421',
--'028423',
--'028438',
--'028438',
--'028440',
--'028443',
--'028451',
--'028460',
--'028466',
--'028467',
--'028468',
--'028477',
--'028127',
--'028134',
--'028141',
--'028147',
--'028150',
--'028151',
--'028156',
--'028159',
--'028160',
--'028162',
--'028168',
--'028170',
--'028171',
--'028172',
--'028177',
--'028178',
--'028180',
--'028187',
--'028194',
--'028202',
--'028204',
--'028207',
--'028212',
--'028217',
--'028219',
--'028222',
--'028230',
--'028233',
--'028235',
--'028236',
--'028242',
--'028245',
--'028249',
--'028254',
--'028479',
--'028480',
--'028599',
--'028602',
--'028610',
--'028614',
--'028617',
--'028622',
--'028623',
--'028631',
--'028638',
--'028644',
--'028384',
--'028389',
--'028390',
--'028391',
--'028398',
--'028399',
--'028403',
--'028404',
--'028405',
--'028406',
--'028412',
--'028414',
--'028419',
--'028424',
--'028163',
--'028164',
--'028166',
--'028174',
--'028175',
--'028176',
--'028184',
--'028190',
--'028206',
--'028208',
--'028209',
--'028216',
--'028218',
--'028223',
--'028224',
--'028225',
--'028232',
--'028255',
--'028261',
--'028264',
--'028265',
--'028270',
--'028274',
--'028275',
--'028292',
--'028294',
--'028295',
--'028300',
--'028301',
--'028305',
--'028119',
--'028120',
--'028122',
--'028129',
--'028137',
--'028138',
--'028144',
--'028145',
--'028146',
--'028237',
--'028239',
--'028240',
--'028241',
--'028244',
--'028246',
--'028258',
--'028259',
--'028266',
--'028273',
--'028278',
--'028279',
--'028282',
--'028283',
--'028285',
--'028287',
--'028296',
--'028298',
--'028313',
--'028314',
--'028317',
--'028318',
--'028323',
--'028330',
--'028338',
--'028344',
--'028345',
--'028351',
--'028646',
--'028651',
--'028663',
--'028672',
--'028675',
--'028515',
--'028518',
--'028521',
--'028523',
--'028526',
--'028527',
--'028528',
--'028530',
--'028535',
--'028535',
--'028535',
--'028537',
--'028539',
--'028553',
--'028558',
--'028563',
--'028566',
--'028571',
--'028573',
--'028576',
--'028577',
--'028584',
--'028593',
--'028690',
--'028692',
--'028694',
--'028698',
--'028702',
--'028705',
--'028706',
--'028707',
--'028387',
--'028388',
--'028393',
--'028396',
--'028400',
--'028411',
--'028413',
--'028418',
--'028420',
--'028422',
--'028155',
--'028165',
--'028173',
--'028182',
--'028183',
--'028185',
--'028191',
--'028196',
--'028306',
--'028308',
--'028310',
--'028311',
--'028316',
--'028319',
--'028320',
--'028325',
--'028326',
--'028328',
--'028334',
--'028335',
--'028336',
--'028339',
--'028342',
--'028347',
--'028350',
--'028357',
--'028360',
--'028366',
--'028368',
--'028370',
--'028372',
--'028378',
--'028487',
--'028488',
--'028496',
--'028501',
--'028502',
--'028385',
--'028386',
--'028394',
--'028395',
--'028401',
--'028407',
--'028408',
--'028410',
--'028415',
--'028416',
--'028417',
--'028426',
--'028427',
--'028430',
--'028431',
--'028437',
--'028448',
--'028449',
--'028450',
--'028453',
--'028454',
--'028459',
--'028461',
--'028465',
--'028478',
--'028482',
--'028594',
--'028601',
--'028604',
--'028607',
--'028609',
--'028611',
--'028612',
--'028620',
--'028621',
--'028624',
--'028629',
--'028630',
--'028636',
--'028637',
--'028639',
--'028641',
--'028647',
--'028197',
--'028198',
--'028199',
--'028200',
--'028201',
--'028203',
--'028213',
--'028215',
--'028226',
--'028231',
--'028238',
--'028243',
--'028250',
--'028253',
--'028256',
--'028262',
--'028267',
--'028268',
--'028720',
--'028722',
--'028723',
--'028724',
--'028732',
--'028735',
--'028738',
--'028748',
--'028751',
--'028753',
--'028760',
--'028761',
--'028762',
--'028767',
--'028769',
--'028776',
--'028779',
--'028780',
--'028781',
--'028782',
--'028787',
--'028792',
--'028795',
--'028800',
--'028801',
--'028802',
--'028803',
--'028805',
--'028808',
--'028814',
--'028815',
--'028826',
--'028831',
--'028835',
--'028837',
--'028838',
--'028842',
--'028848',
--'028362',
--'028363',
--'028369',
--'028374',
--'028377',
--'028379',
--'028484',
--'028490',
--'028493',
--'028494',
--'028497',
--'028504',
--'028506',
--'028511',
--'028514',
--'028522',
--'028524',
--'028529',
--'028534',
--'028538',
--'028546',
--'028547',
--'028548',
--'028550',
--'028556',
--'028560',
--'028561',
--'028567',
--'028580',
--'028581',
--'028586',
--'028588',
--'028696',
--'028703',
--'028708',
--'028716',
--'028719',
--'028721',
--'028721',
--'028727',
--'028727',
--'028733',
--'028736',
--'028740',
--'028749',
--'028755',
--'028757',
--'028764',
--'028765',
--'028772',
--'028774',
--'028775',
--'028433',
--'028435',
--'028442',
--'028447',
--'028457',
--'028458',
--'028462',
--'028464',
--'028475',
--'028476',
--'028481',
--'028596',
--'028597',
--'028598',
--'028600',
--'028603',
--'028605',
--'028613',
--'028627',
--'028632',
--'028633',
--'028634',
--'028635',
--'028640',
--'028642',
--'028645',
--'028648',
--'028655',
--'028657',
--'028658',
--'028668',
--'028669',
--'028670',
--'028673',
--'027473',
--'028679',
--'028680',
--'028778',
--'028269',
--'028272',
--'028277',
--'028280',
--'028289',
--'028297',
--'028297',
--'028303',
--'028304',
--'028307',
--'028312',
--'028324',
--'028331',
--'028332',
--'028333',
--'028337',
--'028343',
--'028346',
--'028353',
--'028354',
--'028356',
--'028361',
--'028375',
--'028376',
--'028380',
--'028491',
--'028492',
--'028498',
--'028499',
--'028500',
--'028505',
--'028508',
--'028516',
--'028517',
--'028533',
--'028540',
--'028541',
--'028545',
--'028549',
--'028555',
--'028559',
--'028562',
--'028572',
--'028574',
--'028575',
--'028579',
--'028582',
--'027002',
--'028686',
--'028687',
--'028688',
--'028689',
--'028695',
--'028697',
--'028699',
--'028700',
--'028701',
--'028709',
--'028710',
--'028711',
--'028717',
--'028718',
--'028726',
--'028650',
--'028786',
--'028788',
--'028789',
--'028794',
--'028797',
--'028804',
--'028806',
--'028810',
--'028816',
--'028818',
--'028818',
--'028821',
--'028828',
--'028830',
--'028832',
--'028839',
--'028843',
--'028851',
--'028852',
--'028589',
--'028590',
--'028348',
--'028653',
--'028654',
--'028656',
--'028659',
--'028662',
--'028664',
--'028665',
--'028674',
--'028676',
--'028681',
--'028512',
--'028513',
--'028520',
--'028525',
--'028536',
--'028544',
--'028551',
--'028554',
--'028564',
--'028565',
--'028568',
--'028570',
--'028578',
--'028583',
--'028585',
--'028587',
--'028591',
--'028592',
--'028592',
--'028592',
--'028685',
--'028691',
--'028693',
--'028704',
--'028712',
--'028713',
--'028714',
--'028715',
--'028725',
--'028519',
--'028734',
--'028737',
--'028739',
--'028744',
--'028745',
--'028746',
--'028754',
--'028756',
--'028759',
--'028768',
--'028770',
--'028777',
--'028683',
--'028684',
--'028790',
--'028793',
--'028811',
--'028812',
--'028813',
--'028819',
--'028820',
--'028825',
--'028825',
--'028827',
--'028829',
--'028836',
--'028844',
--'028845',
--'028846',
--'028728',
--'028729',
--'028730',
--'028731',
--'028741',
--'028742',
--'028743',
--'028747',
--'028750',
--'028752',
--'028758',
--'028763',
--'028766',
--'028771',
--'028425',
--'028432',
--'028434',
--'028436',
--'028439',
--'028441',
--'028444',
--'028445',
--'028446',
--'028452',
--'028455',
--'028456',
--'028463',
--'028470',
--'028471',
--'028473',
--'028474',
--'028483',
--'028595',
--'028606',
--'028608',
--'028615',
--'028616',
--'028618',
--'028619',
--'028625',
--'028626',
--'028628',
--'028643',
--'028652',
--'028660',
--'028661',
--'028666',
--'028667',
--'028671',
--'028677',
--'028678',
--'028682',
--'028783',
--'028784',
--'028785',
--'028791',
--'028796',
--'028798',
--'028807',
--'028809',
--'028817',
--'028822',
--'028823',
--'028824',
--'028834',
--'028840',
--'028841',
--'028849',
--'028850')

-- ALTERACAO SOLICITADA PELO ANTONY EM 28/02/2018:
UPDATE	[VAGAS_DW].[FATURAMENTO]
SET		PRODUTO = 'VAGAS REDES'
FROM	[VAGAS_DW].[FATURAMENTO]
WHERE	NUM_PEDIDO = '049952' ;


-- ALTERACAO SOLICITADA PELO ANTONY EM 28/02/2018:
UPDATE	[VAGAS_DW].[FATURAMENTO]
SET		PRODUTO = 'VAGAS REDES' ,
		GRUPO_II = 'REDES'
FROM	[VAGAS_DW].[FATURAMENTO]
WHERE	NUM_PEDIDO = '049952' ;

-- Alteração solicitada pelo Antony em 01/10/2018:
UPDATE	[VAGAS_DW].[FATURAMENTO]
SET		PRODUTO = 'PUBL ADNETWORK' ,
		GRUPO_I = 'PUBLICIDADE' ,
		GRUPO_II = 'ADNETWORK'
FROM	[VAGAS_DW].[FATURAMENTO] AS A
WHERE	NUM_PEDIDO = '064596'
		AND A.PRODUTO = 'PUBL BANNER'
		AND A.GRUPO_I = 'PUBLICIDADE'
		AND A.GRUPO_II = 'BANNER' ;

-- Alteração solicitada pela Juliana Gomes em 02/10/2018:
UPDATE	[VAGAS_DW].[FATURAMENTO]
SET		PRODUTO = 'PUBL ADNETWORK' ,
		GRUPO_I = 'PUBLICIDADE' ,
		GRUPO_II = 'ADNETWORK'
FROM	[VAGAS_DW].[FATURAMENTO] AS A
WHERE	A.NUM_PEDIDO = '049961'
		AND A.PRODUTO = 'PUBL BANNER' ;